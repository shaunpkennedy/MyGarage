<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h2>Budgets â€” <%= @vehicle.title %></h2>
    <p class="text-muted mb-0"><%= @vehicle.display_name %></p>
  </div>
  <div>
    <%= link_to 'Add Budget', new_vehicle_budget_path(@vehicle), class: 'btn btn-primary me-2' %>
    <%= link_to 'Back to Vehicle', @vehicle, class: 'btn btn-outline-secondary' %>
  </div>
</div>

<% if @budgets.any? %>
  <div class="row">
    <% @budgets.each do |budget| %>
      <%
        pct = budget.percentage_used
        spent = budget.current_spent
        bar_class = case budget.status
                    when :exceeded then 'bg-danger'
                    when :approaching then 'bg-warning'
                    else 'bg-success'
                    end
      %>
      <div class="col-md-6 col-lg-4 mb-4">
        <div class="card shadow-sm h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <div>
                <h5 class="card-title mb-0"><%= budget.category.titleize %></h5>
                <small class="text-muted"><%= budget.period.titleize %></small>
              </div>
              <div class="dropdown">
                <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                  Actions
                </button>
                <ul class="dropdown-menu">
                  <li><%= link_to 'View Details', vehicle_budget_path(@vehicle, budget), class: 'dropdown-item' %></li>
                  <li><%= link_to 'Edit', edit_vehicle_budget_path(@vehicle, budget), class: 'dropdown-item' %></li>
                  <li><hr class="dropdown-divider"></li>
                  <li><%= link_to 'Delete', vehicle_budget_path(@vehicle, budget), data: { turbo_method: :delete, turbo_confirm: 'Delete this budget?' }, class: 'dropdown-item text-danger' %></li>
                </ul>
              </div>
            </div>

            <div class="mb-2">
              <div class="d-flex justify-content-between mb-1">
                <span class="fw-bold"><%= number_to_currency(spent) %></span>
                <span class="text-muted">of <%= number_to_currency(budget.amount) %></span>
              </div>
              <div class="progress" style="height: 10px;">
                <div class="progress-bar <%= bar_class %>" role="progressbar" style="width: <%= [pct, 100].min %>%"></div>
              </div>
              <small class="text-muted"><%= pct %>% used</small>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <div class="text-center py-4">
    <p class="text-muted">No budgets set. Add a budget to start tracking spending limits.</p>
  </div>
<% end %>
