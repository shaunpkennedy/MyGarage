<%= form_with model: [@vehicle, fuel_log], local: true, data: { controller: 'fuel-calc' } do |f| %>
  <% if fuel_log.errors.any? %>
    <div class="alert alert-danger">
      <ul class="mb-0">
        <% fuel_log.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="row">
    <div class="col-md-6 mb-3">
      <%= f.label :log_date, 'Date', class: 'form-label' %>
      <%= f.date_field :log_date, class: 'form-control', required: true %>
    </div>
    <div class="col-md-6 mb-3">
      <%= f.label :odometer, class: 'form-label' %>
      <%= f.number_field :odometer, class: 'form-control', min: 0, required: true %>
    </div>
  </div>

  <div class="row">
    <div class="col-md-4 mb-3">
      <%= f.label :price_per_gallon, '$/Gallon', class: 'form-label' %>
      <%= f.number_field :price_per_gallon, class: 'form-control', step: 0.001, min: 0,
          data: { fuel_calc_target: 'ppg', action: 'input->fuel-calc#calculate' } %>
    </div>
    <div class="col-md-4 mb-3">
      <%= f.label :gallons, class: 'form-label' %>
      <%= f.number_field :gallons, class: 'form-control', step: 0.001, min: 0, required: true,
          data: { fuel_calc_target: 'gallons', action: 'input->fuel-calc#calculate' } %>
    </div>
    <div class="col-md-4 mb-3">
      <%= f.label :total_cost, 'Total Cost', class: 'form-label' %>
      <%= f.number_field :total_cost, class: 'form-control', step: 0.01, min: 0,
          data: { fuel_calc_target: 'totalCost' } %>
    </div>
  </div>

  <% if fuel_log.persisted? && (fuel_log.miles || fuel_log.mpg) %>
    <div class="row">
      <div class="col-md-6 mb-3">
        <label class="form-label">Trip Miles</label>
        <div class="form-control-plaintext fw-bold"><%= fuel_log.miles || '—' %></div>
      </div>
      <div class="col-md-6 mb-3">
        <label class="form-label">MPG</label>
        <div class="form-control-plaintext fw-bold"><%= fuel_log.mpg || '—' %></div>
      </div>
    </div>
  <% end %>
  <div class="form-text mb-3">Miles and MPG are calculated automatically from consecutive odometer readings.</div>

  <div class="d-flex gap-2">
    <%= f.submit class: 'btn btn-primary' %>
    <%= link_to 'Cancel', vehicle_fuel_logs_path(@vehicle), class: 'btn btn-outline-secondary' %>
  </div>
<% end %>
