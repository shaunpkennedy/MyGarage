<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h2>Reminders — <%= @vehicle.title %></h2>
    <p class="text-muted mb-0"><%= @vehicle.display_name %></p>
  </div>
  <div>
    <%= link_to 'Add Reminder', new_vehicle_reminder_path(@vehicle), class: 'btn btn-warning me-2' %>
    <%= link_to 'Back to Vehicle', @vehicle, class: 'btn btn-outline-secondary' %>
  </div>
</div>

<% if @active_reminders.any? %>
  <h4 class="mb-3">Active</h4>
  <div class="card shadow-sm mb-4">
    <div class="card-body p-0">
      <table class="table table-hover mb-0">
        <thead>
          <tr>
            <th>Service</th>
            <th>Type</th>
            <th>Next At</th>
            <th>Miles Remaining</th>
            <th>Notes</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <% @active_reminders.each do |reminder| %>
            <tr class="<%= 'table-danger' if reminder.overdue? %>">
              <td><%= reminder.service_type.name %></td>
              <td><%= reminder.reminder_type&.name %></td>
              <td><%= reminder.next_odometer ? number_with_delimiter(reminder.next_odometer) : '—' %></td>
              <td>
                <% if reminder.miles_remaining %>
                  <% if reminder.overdue? %>
                    <span class="text-danger fw-bold">Overdue by <%= number_with_delimiter(reminder.miles_remaining.abs) %> mi</span>
                  <% else %>
                    <%= number_with_delimiter(reminder.miles_remaining) %> mi
                  <% end %>
                <% else %>
                  —
                <% end %>
              </td>
              <td><%= truncate(reminder.notes, length: 30) %></td>
              <td class="text-end">
                <%= link_to 'Done', complete_vehicle_reminder_path(@vehicle, reminder), data: { turbo_method: :patch, turbo_confirm: 'Mark as completed?' }, class: 'btn btn-sm btn-success me-1' %>
                <%= link_to 'Edit', edit_vehicle_reminder_path(@vehicle, reminder), class: 'btn btn-sm btn-outline-secondary me-1' %>
                <%= link_to 'Delete', vehicle_reminder_path(@vehicle, reminder), data: { turbo_method: :delete, turbo_confirm: 'Delete this reminder?' }, class: 'btn btn-sm btn-outline-danger' %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
<% else %>
  <div class="text-center py-4 mb-4">
    <p class="text-muted">No active reminders.</p>
  </div>
<% end %>

<% if @completed_reminders.any? %>
  <h4 class="mb-3">Completed</h4>
  <div class="card shadow-sm">
    <div class="card-body p-0">
      <table class="table table-hover mb-0">
        <thead>
          <tr>
            <th>Service</th>
            <th>Completed</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody>
          <% @completed_reminders.each do |reminder| %>
            <tr class="table-light">
              <td><%= reminder.service_type.name %></td>
              <td><%= reminder.completed_at&.strftime('%b %d, %Y') %></td>
              <td><%= truncate(reminder.notes, length: 50) %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
<% end %>
